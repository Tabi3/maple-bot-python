from Maple_bot_functions.ExternalLibraries import *

def get_prefix(_client, message):
    with open('./json/prefixes.json', 'r') as f:
        return (lambda x: x[str(message.guild.id)] if str(message.guild.id) in x else ';')(json.load(f))

class myClient(commands.Bot):
    def __init__(self, cp=get_prefix, description = None, **options):
        [super().__init__(cp, None, description = description, **options), os.chdir("./Maple/bot")]+[self.load_extension(
        f"cogs.{j}.{i[:-3]}") for j in os.listdir("./cogs") for i in os.listdir(f"./cogs/{j}") if i.endswith(".py")]+[self.run()]
    
    def run(self):
        return [self, super().run("token")][0]
    
    def reload_all(self):
        return ([self.reload_extension(f"cogs.{j}.{i[:-3]}") for j in os.listdir("./cogs") for i in os.listdir(f"./cogs/{j}") 
                 if i.endswith(".py")]+[self])[-1]