from http.client import HTTPException
import random, json
from Maple_bot_functions.ExternalLibraries import *
from Maple_bot_functions.MapleWebScraper import HentaiHaven, get_video
            

class HavenSelect(nextcord.ui.Select):
    def __init__(self, index=0) -> None:
        options = HentaiHaven()
        options = dict(list(options.items())[25*index:min((index+1)*25, len(options))])
        myoptions = [
            nextcord.SelectOption(label=i, description=options[i][0][:100])
            for i in options
        ]
        self._HavenDict = options
        super().__init__(placeholder="Selected Title", options = myoptions)
        
    async def callback(self, interaction: nextcord.Interaction):
        
        video = get_video({self.values[0]: self._HavenDict[self.values[0]]})
        embed = nextcord.Embed(title=video['title'], description=", ".join(f'`{i}`' for i in video['tags']), 
                               url=video['url/image'][0], color=0xAAF0D1)\
                .add_field(name='Episodes', value=''.join(f'[Episode {i}]({j})\n' for i, j in enumerate(video['episodes'])))\
                .add_field(name='description', value=video['description'][:1024])\
                .set_image(url=video['url/image'][1])
        return await interaction.response.edit_message(embed=embed)
                                                    

        
class View(nextcord.ui.View):
    def __init__(self, *, timeout: float = 120, auto_defer: bool = True, item = None):
        super().__init__(timeout=timeout, auto_defer=auto_defer)
        self.add_item(item)
        
        